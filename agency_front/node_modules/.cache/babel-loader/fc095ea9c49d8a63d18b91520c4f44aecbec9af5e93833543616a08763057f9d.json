{"ast":null,"code":"var _jsxFileName = \"D:\\\\study\\\\Agency\\\\agency_front\\\\src\\\\constants\\\\ExcelReportGenerator.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { utils, writeFile } from 'xlsx';\nimport { getClientsByManager, getHousingPreferences } from '../api/clientService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExcelReportButton = ({\n  managerId\n}) => {\n  _s();\n  const [isLoading, setIsLoading] = useState(false);\n  const handleDownload = async () => {\n    try {\n      setIsLoading(true);\n\n      // 1. Получаем клиентов\n      const clients = await getClientsByManager(managerId);\n\n      // 2. Собираем данные с предпочтениями\n      const data = await Promise.all(clients.map(async client => ({\n        ...client,\n        preferences: await getClientPreferences(client.id)\n      })));\n\n      // 3. Формируем Excel файл\n      const worksheet = utils.json_to_sheet(data.map(client => ({\n        'ФИО': client.fullName,\n        'Телефон': client.phone,\n        'Email': client.email,\n        'Предпочтения': client.preferences.join(', '),\n        'Дата регистрации': new Date(client.createdAt).toLocaleDateString()\n      })));\n      const workbook = utils.book_new();\n      utils.book_append_sheet(workbook, worksheet, 'Клиенты');\n\n      // 4. Скачиваем файл\n      writeFile(workbook, `clients_report_${new Date().toISOString().slice(0, 10)}.xlsx`);\n    } catch (error) {\n      console.error('Ошибка:', error);\n      alert('Не удалось сформировать отчет');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleDownload,\n    disabled: isLoading,\n    style: {\n      padding: '10px 20px',\n      background: isLoading ? '#ccc' : '#2196F3',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      cursor: 'pointer'\n    },\n    children: isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 9\n  }, this);\n};\n\n// Вспомогательная функция для получения предпочтений\n_s(ExcelReportButton, \"EmvgwIb3cHpoFpeP+WmEDbjx4y4=\");\n_c = ExcelReportButton;\nconst getClientPreferences = async clientId => {\n  try {\n    const preferences = await getHousingPreferences(clientId);\n    return preferences.map(p => p.name);\n  } catch (e) {\n    console.error(`Ошибка для клиента ${clientId}:`, e);\n    return ['не указано'];\n  }\n};\nexport default ExcelReportButton;\nvar _c;\n$RefreshReg$(_c, \"ExcelReportButton\");","map":{"version":3,"names":["React","useState","utils","writeFile","getClientsByManager","getHousingPreferences","jsxDEV","_jsxDEV","ExcelReportButton","managerId","_s","isLoading","setIsLoading","handleDownload","clients","data","Promise","all","map","client","preferences","getClientPreferences","id","worksheet","json_to_sheet","fullName","phone","email","join","Date","createdAt","toLocaleDateString","workbook","book_new","book_append_sheet","toISOString","slice","error","console","alert","onClick","disabled","style","padding","background","color","border","borderRadius","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","clientId","p","name","e","$RefreshReg$"],"sources":["D:/study/Agency/agency_front/src/constants/ExcelReportGenerator.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { utils, writeFile } from 'xlsx';\r\nimport { getClientsByManager, getHousingPreferences } from '../api/clientService';\r\n\r\nconst ExcelReportButton = ({ managerId }) => {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleDownload = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n\r\n            // 1. Получаем клиентов\r\n            const clients = await getClientsByManager(managerId);\r\n\r\n            // 2. Собираем данные с предпочтениями\r\n            const data = await Promise.all(\r\n                clients.map(async (client) => ({\r\n                    ...client,\r\n                    preferences: await getClientPreferences(client.id)\r\n                }))\r\n            );\r\n\r\n            // 3. Формируем Excel файл\r\n            const worksheet = utils.json_to_sheet(\r\n                data.map(client => ({\r\n                    'ФИО': client.fullName,\r\n                    'Телефон': client.phone,\r\n                    'Email': client.email,\r\n                    'Предпочтения': client.preferences.join(', '),\r\n                    'Дата регистрации': new Date(client.createdAt).toLocaleDateString()\r\n                }))\r\n            );\r\n\r\n            const workbook = utils.book_new();\r\n            utils.book_append_sheet(workbook, worksheet, 'Клиенты');\r\n\r\n            // 4. Скачиваем файл\r\n            writeFile(workbook, `clients_report_${new Date().toISOString().slice(0,10)}.xlsx`);\r\n\r\n        } catch (error) {\r\n            console.error('Ошибка:', error);\r\n            alert('Не удалось сформировать отчет');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handleDownload}\r\n            disabled={isLoading}\r\n            style={{\r\n                padding: '10px 20px',\r\n                background: isLoading ? '#ccc' : '#2196F3',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer'\r\n            }}\r\n        >\r\n            {isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'}\r\n        </button>\r\n    );\r\n};\r\n\r\n// Вспомогательная функция для получения предпочтений\r\nconst getClientPreferences = async (clientId) => {\r\n    try {\r\n        const preferences = await getHousingPreferences(clientId);\r\n        return preferences.map(p => p.name);\r\n    } catch (e) {\r\n        console.error(`Ошибка для клиента ${clientId}:`, e);\r\n        return ['не указано'];\r\n    }\r\n};\r\n\r\nexport default ExcelReportButton;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}