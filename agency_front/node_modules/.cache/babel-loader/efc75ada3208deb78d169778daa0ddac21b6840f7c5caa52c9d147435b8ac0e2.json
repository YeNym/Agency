{"ast":null,"code":"var _jsxFileName = \"D:\\\\study\\\\Agency\\\\agency_front\\\\src\\\\constants\\\\ExcelReportGenerator.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { utils, writeFile } from 'xlsx';\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExcelReportButton = ({\n  managerId\n}) => {\n  _s();\n  const [isLoading, setIsLoading] = useState(false);\n  const handleDownload = async () => {\n    try {\n      setIsLoading(true);\n      const clients = await getClientsByManager(managerId);\n      const data = await Promise.all(clients.map(async client => {\n        const [userData, preferences] = await Promise.all([getClientUser(client.id), getClientPreferences(client.id)]);\n        return {\n          ...client,\n          ...userData,\n          preferences\n        };\n      }));\n      const worksheet = utils.json_to_sheet(data.map(client => ({\n        'ФИО': client.fullName,\n        'Телефон': client.phone || 'Не указано',\n        'Email': client.email || 'Не указано',\n        'Предпочтения': client.preferences.join(', ')\n      })));\n      const workbook = utils.book_new();\n      utils.book_append_sheet(workbook, worksheet, 'Клиенты');\n\n      // 4. Скачиваем файл\n      writeFile(workbook, `clients_report_${new Date().toISOString().slice(0, 10)}.xlsx`);\n    } catch (error) {\n      console.error('Ошибка:', error);\n      alert('Не удалось сформировать отчет');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleDownload,\n    disabled: isLoading,\n    style: {\n      padding: '10px 20px',\n      background: isLoading ? '#ccc' : '#2196F3',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      cursor: 'pointer'\n    },\n    children: isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 52,\n    columnNumber: 9\n  }, this);\n};\n_s(ExcelReportButton, \"EmvgwIb3cHpoFpeP+WmEDbjx4y4=\");\n_c = ExcelReportButton;\nconst getClientUser = async clientId => {\n  try {\n    const userData = await getUserByClientId(clientId);\n\n    // Формируем полное имя\n    const fullNameParts = [userData.lastname, userData.firstname, userData.patronymic].filter(Boolean); // Удаляем пустые/undefined значения\n\n    return {\n      fullName: fullNameParts.join(' ') || 'Не указано',\n      phone: userData.phone,\n      email: userData.email\n    };\n  } catch (e) {\n    console.error(`Ошибка для клиента ${clientId}:`, e);\n    return {\n      fullName: 'Не указано',\n      phone: 'Не указано',\n      email: 'Не указано'\n    };\n  }\n};\n\n// Вспомогательная функция для получения предпочтений\nconst getClientPreferences = async clientId => {\n  try {\n    const preferences = await getHousingPreferences(clientId);\n    return preferences.map(p => p.name);\n  } catch (e) {\n    console.error(`Ошибка для клиента ${clientId}:`, e);\n    return ['не указано'];\n  }\n};\nexport default ExcelReportButton;\nvar _c;\n$RefreshReg$(_c, \"ExcelReportButton\");","map":{"version":3,"names":["React","useState","utils","writeFile","getClientsByManager","getHousingPreferences","getUserByClientId","jsxDEV","_jsxDEV","ExcelReportButton","managerId","_s","isLoading","setIsLoading","handleDownload","clients","data","Promise","all","map","client","userData","preferences","getClientUser","id","getClientPreferences","worksheet","json_to_sheet","fullName","phone","email","join","workbook","book_new","book_append_sheet","Date","toISOString","slice","error","console","alert","onClick","disabled","style","padding","background","color","border","borderRadius","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","clientId","fullNameParts","lastname","firstname","patronymic","filter","Boolean","e","p","name","$RefreshReg$"],"sources":["D:/study/Agency/agency_front/src/constants/ExcelReportGenerator.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { utils, writeFile } from 'xlsx';\r\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\r\n\r\nconst ExcelReportButton = ({ managerId }) => {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleDownload = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n            const clients = await getClientsByManager(managerId);\r\n\r\n            const data = await Promise.all(\r\n                clients.map(async (client) => {\r\n                    const [userData, preferences] = await Promise.all([\r\n                        getClientUser(client.id),\r\n                        getClientPreferences(client.id)\r\n                    ]);\r\n\r\n                    return {\r\n                        ...client,\r\n                        ...userData,\r\n                        preferences\r\n                    };\r\n                })\r\n            );\r\n\r\n            const worksheet = utils.json_to_sheet(\r\n                data.map(client => ({\r\n                    'ФИО': client.fullName,\r\n                    'Телефон': client.phone || 'Не указано',\r\n                    'Email': client.email || 'Не указано',\r\n                    'Предпочтения': client.preferences.join(', '),\r\n                }))\r\n            );\r\n\r\n            const workbook = utils.book_new();\r\n            utils.book_append_sheet(workbook, worksheet, 'Клиенты');\r\n\r\n            // 4. Скачиваем файл\r\n            writeFile(workbook, `clients_report_${new Date().toISOString().slice(0,10)}.xlsx`);\r\n\r\n        } catch (error) {\r\n            console.error('Ошибка:', error);\r\n            alert('Не удалось сформировать отчет');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handleDownload}\r\n            disabled={isLoading}\r\n            style={{\r\n                padding: '10px 20px',\r\n                background: isLoading ? '#ccc' : '#2196F3',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer'\r\n            }}\r\n        >\r\n            {isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'}\r\n        </button>\r\n    );\r\n};\r\n\r\nconst getClientUser = async (clientId) => {\r\n    try {\r\n        const userData = await getUserByClientId(clientId);\r\n\r\n        // Формируем полное имя\r\n        const fullNameParts = [\r\n            userData.lastname,\r\n            userData.firstname,\r\n            userData.patronymic\r\n\r\n        ].filter(Boolean); // Удаляем пустые/undefined значения\r\n\r\n        return {\r\n            fullName: fullNameParts.join(' ') || 'Не указано',\r\n            phone: userData.phone,\r\n            email: userData.email\r\n        };\r\n    } catch (e) {\r\n        console.error(`Ошибка для клиента ${clientId}:`, e);\r\n        return {\r\n            fullName: 'Не указано',\r\n            phone: 'Не указано',\r\n            email: 'Не указано'\r\n        };\r\n    }\r\n};\r\n\r\n// Вспомогательная функция для получения предпочтений\r\nconst getClientPreferences = async (clientId) => {\r\n    try {\r\n        const preferences = await getHousingPreferences(clientId);\r\n        return preferences.map(p => p.name);\r\n    } catch (e) {\r\n        console.error(`Ошибка для клиента ${clientId}:`, e);\r\n        return ['не указано'];\r\n    }\r\n};\r\n\r\nexport default ExcelReportButton;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}