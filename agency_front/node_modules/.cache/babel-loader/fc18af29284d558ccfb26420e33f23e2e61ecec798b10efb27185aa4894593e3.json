{"ast":null,"code":"var _jsxFileName = \"D:\\\\study\\\\Agency\\\\agency_front\\\\src\\\\constants\\\\ExcelReportGenerator.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { utils, writeFile } from 'xlsx';\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExcelReportButton = ({\n  managerId\n}) => {\n  _s();\n  const [isLoading, setIsLoading] = useState(false);\n  const handleDownload = async () => {\n    try {\n      setIsLoading(true);\n      const clients = await getClientsByManager(managerId);\n      console.log('Clients:', JSON.stringify(clients, null, 2));\n      const data = await Promise.all(clients.map(async client => {\n        const [userData, preferences] = await Promise.all([getClientUser(client.id)]);\n        return {\n          ...client,\n          ...userData,\n          preferences\n        };\n      }));\n      console.log(data);\n      const worksheet = utils.json_to_sheet(data.map(client => {\n        var _client$phone, _client$authUser$emai, _client$authUser, _client$passport;\n        return {\n          'Статус': client.accessLevel || 'Не указан',\n          'ФИО': client.fullName,\n          'Телефон': (_client$phone = client.phone) !== null && _client$phone !== void 0 ? _client$phone : 'Не указано',\n          // Берем из клиента\n          'Email': (_client$authUser$emai = (_client$authUser = client.authUser) === null || _client$authUser === void 0 ? void 0 : _client$authUser.email) !== null && _client$authUser$emai !== void 0 ? _client$authUser$emai : 'Не указано',\n          // Берем email из authUser\n          'Паспорт': (_client$passport = client.passport) !== null && _client$passport !== void 0 ? _client$passport : 'Не указано' // Берем из клиента\n        };\n      }));\n      const workbook = utils.book_new();\n      utils.book_append_sheet(workbook, worksheet, 'Клиенты');\n\n      // 4. Скачиваем файл\n      writeFile(workbook, `clients_report_${new Date().toISOString().slice(0, 10)}.xlsx`);\n    } catch (error) {\n      console.error('Ошибка:', error);\n      alert('Не удалось сформировать отчет');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleDownload,\n    disabled: isLoading,\n    style: {\n      padding: '10px 20px',\n      background: isLoading ? '#ccc' : '#2196F3',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      cursor: 'pointer'\n    },\n    children: isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 9\n  }, this);\n};\n_s(ExcelReportButton, \"EmvgwIb3cHpoFpeP+WmEDbjx4y4=\");\n_c = ExcelReportButton;\nconst getClientUser = async clientId => {\n  try {\n    var _userData$email;\n    const userData = await getUserByClientId(clientId);\n\n    // Формируем только ФИО\n    const fullNameParts = [userData.lastname, userData.firstname, userData.patronymic].filter(Boolean);\n    return {\n      fullName: fullNameParts.join(' ') || 'Не указано',\n      email: (_userData$email = userData.email) !== null && _userData$email !== void 0 ? _userData$email : 'Не указано' // Добавлено поле email\n    };\n  } catch (e) {\n    return {\n      fullName: 'Не указано',\n      email: 'Не указано' // Добавлено поле email\n    };\n  }\n};\nexport default ExcelReportButton;\nvar _c;\n$RefreshReg$(_c, \"ExcelReportButton\");","map":{"version":3,"names":["React","useState","utils","writeFile","getClientsByManager","getHousingPreferences","getUserByClientId","jsxDEV","_jsxDEV","ExcelReportButton","managerId","_s","isLoading","setIsLoading","handleDownload","clients","console","log","JSON","stringify","data","Promise","all","map","client","userData","preferences","getClientUser","id","worksheet","json_to_sheet","_client$phone","_client$authUser$emai","_client$authUser","_client$passport","accessLevel","fullName","phone","authUser","email","passport","workbook","book_new","book_append_sheet","Date","toISOString","slice","error","alert","onClick","disabled","style","padding","background","color","border","borderRadius","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","clientId","_userData$email","fullNameParts","lastname","firstname","patronymic","filter","Boolean","join","e","$RefreshReg$"],"sources":["D:/study/Agency/agency_front/src/constants/ExcelReportGenerator.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { utils, writeFile } from 'xlsx';\r\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\r\n\r\nconst ExcelReportButton = ({ managerId }) => {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleDownload = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n            const clients = await getClientsByManager(managerId);\r\n            console.log('Clients:', JSON.stringify(clients, null, 2));\r\n            const data = await Promise.all(\r\n                clients.map(async (client) => {\r\n                    const [userData, preferences] = await Promise.all([\r\n                        getClientUser(client.id),\r\n                    ]);\r\n\r\n                    return {\r\n                        ...client,\r\n                        ...userData,\r\n                        preferences\r\n                    };\r\n                })\r\n            );\r\nconsole.log(data)\r\n            const worksheet = utils.json_to_sheet(\r\n                data.map(client => ({\r\n                    'Статус': client.accessLevel || 'Не указан',\r\n                    'ФИО': client.fullName,\r\n                    'Телефон': client.phone ?? 'Не указано', // Берем из клиента\r\n                    'Email': client.authUser?.email ?? 'Не указано', // Берем email из authUser\r\n                    'Паспорт': client.passport ?? 'Не указано', // Берем из клиента\r\n\r\n                }))\r\n            );\r\n\r\n            const workbook = utils.book_new();\r\n            utils.book_append_sheet(workbook, worksheet, 'Клиенты');\r\n\r\n            // 4. Скачиваем файл\r\n            writeFile(workbook, `clients_report_${new Date().toISOString().slice(0,10)}.xlsx`);\r\n\r\n        } catch (error) {\r\n            console.error('Ошибка:', error);\r\n            alert('Не удалось сформировать отчет');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handleDownload}\r\n            disabled={isLoading}\r\n            style={{\r\n                padding: '10px 20px',\r\n                background: isLoading ? '#ccc' : '#2196F3',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer'\r\n            }}\r\n        >\r\n            {isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'}\r\n        </button>\r\n    );\r\n};\r\n\r\nconst getClientUser = async (clientId) => {\r\n    try {\r\n        const userData = await getUserByClientId(clientId);\r\n\r\n        // Формируем только ФИО\r\n        const fullNameParts = [\r\n            userData.lastname,\r\n            userData.firstname,\r\n            userData.patronymic\r\n        ].filter(Boolean);\r\n\r\n        return {\r\n            fullName: fullNameParts.join(' ') || 'Не указано',\r\n            email: userData.email ?? 'Не указано' // Добавлено поле email\r\n\r\n        };\r\n    } catch (e) {\r\n        return {\r\n            fullName: 'Не указано',\r\n            email: 'Не указано' // Добавлено поле email\r\n\r\n        };\r\n    }\r\n};\r\n\r\n\r\nexport default ExcelReportButton;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}