{"ast":null,"code":"var _jsxFileName = \"D:\\\\study\\\\Agency\\\\agency_front\\\\src\\\\constants\\\\ExcelReportGenerator.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { utils, writeFile } from 'xlsx';\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExcelReportButton = ({\n  managerId\n}) => {\n  _s();\n  const [isLoading, setIsLoading] = useState(false);\n  const handleDownload = async () => {\n    try {\n      setIsLoading(true);\n      const clients = await getClientsByManager(managerId);\n      console.log('Clients:', JSON.stringify(clients, null, 2));\n      const data = await Promise.all(clients.map(async client => {\n        const [userData, preferences] = await Promise.all([getClientUser(client.id), getClientPreferences(client.id)]);\n        return {\n          ...client,\n          ...userData,\n          preferences\n        };\n      }));\n      console.log(data);\n      const worksheet = utils.json_to_sheet(data.map(client => {\n        var _client$phone, _client$email, _client$passport, _client$preferences;\n        return {\n          'Статус': client.accessLevel || 'Не указан',\n          'ФИО': client.fullName,\n          'Телефон': (_client$phone = client.phone) !== null && _client$phone !== void 0 ? _client$phone : 'Не указано',\n          // Берем из клиента\n          'Email': (_client$email = client.email) !== null && _client$email !== void 0 ? _client$email : 'Не указано',\n          'Паспорт': (_client$passport = client.passport) !== null && _client$passport !== void 0 ? _client$passport : 'Не указано',\n          // Берем из клиента\n          'Предпочтения': (_client$preferences = client.preferences) !== null && _client$preferences !== void 0 && _client$preferences.length ? client.preferences.join(', ') : 'Нет предпочтений'\n        };\n      }));\n      const workbook = utils.book_new();\n      utils.book_append_sheet(workbook, worksheet, 'Клиенты');\n\n      // 4. Скачиваем файл\n      writeFile(workbook, `clients_report_${new Date().toISOString().slice(0, 10)}.xlsx`);\n    } catch (error) {\n      console.error('Ошибка:', error);\n      alert('Не удалось сформировать отчет');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleDownload,\n    disabled: isLoading,\n    style: {\n      padding: '10px 20px',\n      background: isLoading ? '#ccc' : '#2196F3',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      cursor: 'pointer'\n    },\n    children: isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 9\n  }, this);\n};\n_s(ExcelReportButton, \"EmvgwIb3cHpoFpeP+WmEDbjx4y4=\");\n_c = ExcelReportButton;\nconst getClientUser = async clientId => {\n  try {\n    var _userData$email;\n    const userData = await getUserByClientId(clientId);\n\n    // Формируем только ФИО\n    const fullNameParts = [userData.lastname, userData.firstname, userData.patronymic].filter(Boolean);\n    return {\n      fullName: fullNameParts.join(' ') || 'Не указано',\n      email: (_userData$email = userData.email) !== null && _userData$email !== void 0 ? _userData$email : 'Не указано' // Добавлено поле email\n    };\n  } catch (e) {\n    return {\n      fullName: 'Не указано',\n      email: 'Не указано' // Добавлено поле email\n    };\n  }\n};\n\n// Вспомогательная функция для получения предпочтений\nconst getClientPreferences = async clientId => {\n  try {\n    const preferences = await getHousingPreferences(clientId);\n    return preferences.map(p => p.name);\n  } catch (e) {\n    console.error(`Ошибка для клиента ${clientId}:`, e);\n    return ['не указано'];\n  }\n};\nexport default ExcelReportButton;\nvar _c;\n$RefreshReg$(_c, \"ExcelReportButton\");","map":{"version":3,"names":["React","useState","utils","writeFile","getClientsByManager","getHousingPreferences","getUserByClientId","jsxDEV","_jsxDEV","ExcelReportButton","managerId","_s","isLoading","setIsLoading","handleDownload","clients","console","log","JSON","stringify","data","Promise","all","map","client","userData","preferences","getClientUser","id","getClientPreferences","worksheet","json_to_sheet","_client$phone","_client$email","_client$passport","_client$preferences","accessLevel","fullName","phone","email","passport","length","join","workbook","book_new","book_append_sheet","Date","toISOString","slice","error","alert","onClick","disabled","style","padding","background","color","border","borderRadius","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","clientId","_userData$email","fullNameParts","lastname","firstname","patronymic","filter","Boolean","e","p","name","$RefreshReg$"],"sources":["D:/study/Agency/agency_front/src/constants/ExcelReportGenerator.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { utils, writeFile } from 'xlsx';\r\nimport { getClientsByManager, getHousingPreferences, getUserByClientId } from '../api/ClientService';\r\n\r\nconst ExcelReportButton = ({ managerId }) => {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleDownload = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n            const clients = await getClientsByManager(managerId);\r\n            console.log('Clients:', JSON.stringify(clients, null, 2));\r\n            const data = await Promise.all(\r\n                clients.map(async (client) => {\r\n                    const [userData, preferences] = await Promise.all([\r\n                        getClientUser(client.id),\r\n                        getClientPreferences(client.id)\r\n                    ]);\r\n\r\n                    return {\r\n                        ...client,\r\n                        ...userData,\r\n                        preferences\r\n                    };\r\n                })\r\n            );\r\nconsole.log(data)\r\n            const worksheet = utils.json_to_sheet(\r\n                data.map(client => ({\r\n                    'Статус': client.accessLevel || 'Не указан',\r\n                    'ФИО': client.fullName,\r\n                    'Телефон': client.phone ?? 'Не указано', // Берем из клиента\r\n                    'Email': client.email ?? 'Не указано',\r\n                    'Паспорт': client.passport ?? 'Не указано', // Берем из клиента\r\n                    'Предпочтения': client.preferences?.length\r\n                        ? client.preferences.join(', ')\r\n                        : 'Нет предпочтений'\r\n                }))\r\n            );\r\n\r\n            const workbook = utils.book_new();\r\n            utils.book_append_sheet(workbook, worksheet, 'Клиенты');\r\n\r\n            // 4. Скачиваем файл\r\n            writeFile(workbook, `clients_report_${new Date().toISOString().slice(0,10)}.xlsx`);\r\n\r\n        } catch (error) {\r\n            console.error('Ошибка:', error);\r\n            alert('Не удалось сформировать отчет');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handleDownload}\r\n            disabled={isLoading}\r\n            style={{\r\n                padding: '10px 20px',\r\n                background: isLoading ? '#ccc' : '#2196F3',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer'\r\n            }}\r\n        >\r\n            {isLoading ? 'Формируем отчет...' : 'Скачать отчет в Excel'}\r\n        </button>\r\n    );\r\n};\r\n\r\nconst getClientUser = async (clientId) => {\r\n    try {\r\n        const userData = await getUserByClientId(clientId);\r\n\r\n        // Формируем только ФИО\r\n        const fullNameParts = [\r\n            userData.lastname,\r\n            userData.firstname,\r\n            userData.patronymic\r\n        ].filter(Boolean);\r\n\r\n        return {\r\n            fullName: fullNameParts.join(' ') || 'Не указано',\r\n            email: userData.email ?? 'Не указано' // Добавлено поле email\r\n\r\n        };\r\n    } catch (e) {\r\n        return {\r\n            fullName: 'Не указано',\r\n            email: 'Не указано' // Добавлено поле email\r\n\r\n        };\r\n    }\r\n};\r\n\r\n// Вспомогательная функция для получения предпочтений\r\nconst getClientPreferences = async (clientId) => {\r\n    try {\r\n        const preferences = await getHousingPreferences(clientId);\r\n        return preferences.map(p => p.name);\r\n    } catch (e) {\r\n        console.error(`Ошибка для клиента ${clientId}:`, e);\r\n        return ['не указано'];\r\n    }\r\n};\r\n\r\nexport default ExcelReportButton;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}